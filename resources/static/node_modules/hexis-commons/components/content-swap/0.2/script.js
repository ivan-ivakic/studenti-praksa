;(function(){


  function check() {
    console.log('swapCheck()');
    var currentHosts = document.body.querySelectorAll('.swapActive');

    array(currentHosts).forEach(function(currentHost){
      var swapLink = currentHost.getAttribute('data-swapLink');
      var swapConditions = currentHost.getAttribute('data-swapConditions').split(' ');
      var matchesConditions = App.matchAllConditions(swapConditions);
      console.log(currentHost, swapConditions, matchesConditions);

      // If the current host does not match its own criteria, we try to find a new one
      if (!matchesConditions) {
        var potentialHosts = document.body.querySelectorAll('[data-swapLink="'+swapLink+'"]:not([data-swapActive])');
        var matchingHost = null;

        array(potentialHosts).forEach(function(pHost){
          var pHost_conditions = pHost.getAttribute('data-swapConditions').split(' ');
          console.log(pHost, pHost_conditions, App.matchAllConditions(pHost_conditions));
          if (App.matchAllConditions(pHost_conditions)) {
            matchingHost = pHost;
            return;
          }
        });

        // Swap the content of the two
        if (matchingHost !== null) {
          swapContent(currentHost, matchingHost);
        }
      }
    });
  }


  function swapContent(from, to) {
    console.log('Swapping content...');

    // Swap HTML
    to.innerHTML = from.innerHTML;
    from.innerHTML = '';

    // Update visibility
    from.classList.remove('swapActive');
    to.classList.add('swapActive');
  }


  window.SwapCheck = check; // Export the check function publicly
})(document);


whenReady(function(){
  SwapCheck();
});


queue.globalResize.push(function(){
  SwapCheck();
});
