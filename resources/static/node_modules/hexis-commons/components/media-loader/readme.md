# Media Loader

Small javascript library to help with media loading. Notable features:

- lazy load various media (images, videos, iframes)

- lazy load background images (on elements like div, section, etc.)

- deliver different image sizes based on screen size and/or resolution

- provide a callback when all media within the target element scope are loaded (including background images)


## Requirements

- Satin framework (only because of media queries, such as "small", "medium", etc.). This dependency should be removed in the future.

- [Hexis ScriptCore](https://github.com/Internet-Inovacije/hexis-commons/tree/master/scripts/core)

- Visitors with enabled javascript (```<noscript>``` can be used be used to serve fallback content)


## How to use

1. Include media-loader scripts in your javascript build file (after script-core)

2. Instead of ```src``` use ```data-src``` and the image will lazyLoad if in view or about to be in view

3. Optional: add a fallback media in a ```noscript``` tag


## Examples

```html
<!-- Basic lazy load with <noscript> fallback -->
<img data-src='path/to/image.png' alt=''>
<noscript><img data-src='path/to/image.png' alt=''></noscript>

<!-- Lazy load with multiple sources conditions -->
<img data-src='path/to/image.jpg, path/to/some/other/largeImage.png -large -@2x' alt=''>

<!-- More readable syntax. This will also work. -->
<img data-src='[
  path/to/image.jpg,
  secondary/path/to/mediumImage.svg -medium,
  third/path/to/largeImage.png -large -@2x
]' alt=''>

<!-- Lazy load an iframe, audio, or video the same way -->
<iframe data-src='path/to/whatever.html'></iframe>
<audio data-src='path/to/someAudio.mp3'></audio>
<video data-src='path/to/someVideo.mp4'></video>
```

You do not have a limit on the number of sources. The only thing to keep in mind is that the sources are matched in reverse order. Last source you define will be tried to match first. If it matches, the script stops.

Possible conditions are Satin screen sizes ```[small, smallPlus, medium, mediumPlus, large, largePlus]```, and screen resolution such as ```[@1x, @2x]```.

Conditions must be space separated and prepended with a dash ``` -```. So ``` -large``` or ``` -@2x```.


## Background images

By using ```data-src``` on elements which do not have a src attribute natively (```div```, ```section```, etc.) it becomes a css background image instead. You can use multiple source just like before.

```html
<!-- Lazy load a background image... -->
<div data-src='path/to/image.png'>

<!-- ...becomes... -->
<div style='background-image:url(path/to/image.png)'>
```


## waitForAll()

While working in javascript, media-loader provides you with an encapsulation which waits for all media to load before executing your code.

This is very useful to initiate some sliders, animations, etc. only after all of the images within have been loaded. This can prevent many design problems by forcing a strict load/execution order.

```javascript
App.mediaLoader.waitForAll('#header', function(){
  // Execute this code after all media files inside #header have loaded
});
```


## data-ignore

If you have another script which is going to utilise the ```data-src``` attribute, then add a ```data-ignore``` attribute to it as well, and the MediaLoader will ignore this particular node, leaving it intact for the other script.

```html
<img data-src='path/to/image.png' data-ignore alt=''>
```


## Undocumented

- Delaying media load with data-delay
- Preload priorities. Allows a more fine grained control over the load order of delayed media
